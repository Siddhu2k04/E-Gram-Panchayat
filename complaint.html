<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Complaint - E-Gram Panchayat Anurabad</title>

  <!-- Custom Styles and JS -->
  <link rel="stylesheet" href="css/style.css" />
  <script src="js/main.js"></script>
  <script src="js/translator.js"></script>

  <!-- Firebase Compatibility SDKs for HTML -->
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- Language Translator -->
<div id="google_translate_element"></div>

<!-- Header and Navigation -->
<header>
  <h1>E-Gram Panchayat Anurabad</h1>
</header>

<header class="menu-header">
  <div class="logo">Complaint</div>
  <button class="menu-toggle" id="menu-btn">&#9776;</button>
  <nav class="dropdown-menu" id="menu">
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="notices.html">Notices</a>
    <a href="members.html">Members</a>
    <a href="gallery.html">Gallery</a>
    <a href="contact.html">Contact</a>
    <a href="complaint.html">Complaint</a>
    <a href="admin/admin.html">Admin</a>
  </nav>
</header>

<script>
  const btn = document.getElementById('menu-btn');
  const menu = document.getElementById('menu');
  btn.addEventListener('click', () => {
    menu.classList.toggle('show');
  });
</script>

<!-- Complaint Form Section -->
<div class="form-container">
  <h2>üì¢ File a Complaint</h2>
  <form id="complaintForm" enctype="multipart/form-data">
    <label>Full Name</label>
    <input type="text" name="name" required>

    <label>Email</label>
    <input type="email" name="email" required>

    <label>Complaint Description</label>
    <textarea name="description" rows="5" required></textarea>

    <label>Upload Image (optional)</label>
    <input type="file" name="image" accept="image/*">

    <button type="submit">Submit Complaint</button>
  </form>
</div>

<!-- Firebase Configuration and Form Logic -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC0Wj7L2WpxYFAk0_XXvj0Kxtz_DbqGZHE",
    authDomain: "e-gram-panchayat-75f4a.firebaseapp.com",
    projectId: "e-gram-panchayat-75f4a",
    appId: "1:501188627743:web:c362fa66298786ee6e742a"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // üîê Your imgbb API key (for image upload)
  const imgbbAPIKey = "8f40758b4628cd43936c08733eb01ef9";

  async function uploadToImgBB(file) {
    const formData = new FormData();
    formData.append("image", file);
    const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbAPIKey}`, {
      method: "POST",
      body: formData
    });
    const data = await response.json();
    return data.data.url;
  }

  document.getElementById("complaintForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = e.target.name.value;
    const email = e.target.email.value;
    const description = e.target.description.value;
    const imageFile = e.target.image.files[0];
    
    let imageUrl = "";
    if (imageFile) {
      try {
        imageUrl = await uploadToImgBB(imageFile);
      } catch (error) {
        alert("‚ùå Image upload failed");
        return;
      }
    }

    try {
      await db.collection("complaints").add({
        name,
        email,
        description,
        imageUrl,
        timestamp: firebase.firestore.Timestamp.now()
      });
      alert("‚úÖ Complaint submitted successfully!");
      e.target.reset();
    } catch (err) {
      alert("‚ùå Error saving complaint: " + err.message);
    }
  });
</script>

<!-- Footer -->
<footer>
  &copy; 2025 E-Gram Panchayat Anurabad. All rights reserved.
</footer>

</body>
</html>
